<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My App</title>
    <style>
        html, body { height: 100%; width: 100%; margin: 0; padding: 0; overflow: hidden; }
        iframe { width: 100%; height: 100%; border: none; display: block; }
    </style>
</head>
<body>
    <!-- The iframe will be created by script now -->
    <div id="iframe-container" style="width:100%; height:100%;"></div>

    <script>
        const appScriptUrl = "https://script.google.com/macros/s/AKfycbz4vY3Wwgbfn89hR1TTToV1XKCn_MGri3UkpKTLrX34F0BBuSKrgEdEcLK2YVBwXFJd/exec";

        // Dynamically create the iframe with the origin parameter
        const iframe = document.createElement('iframe');
        
        // Pass our current origin to the Apps Script app
        const urlWithOrigin = appScriptUrl + "?origin=" + encodeURIComponent(window.location.origin);
        iframe.src = urlWithOrigin;
        
        const container = document.getElementById('iframe-container');
        container.appendChild(iframe);

        function sendViewportHeight() {
            const height = window.visualViewport.height;
            console.log("Parent: Sending height ->", height);
            
            // We can now be specific with the target origin because we know it.
            // Using '*' is also fine, as the security is now handled on the receiver.
            iframe.contentWindow.postMessage({ height: height }, '*');
        }

        iframe.onload = function() {
            console.log("Parent: iframe loaded. Sending initial height.");
            sendViewportHeight();
        };

        window.visualViewport.addEventListener('resize', sendViewportHeight);
    </script>
</body>
</html>
